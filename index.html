<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>تتريس — بسيط</title>
<style>
  :root{
    --bg:#0a1424; --panel:#0f1d33; --board:#152642; --cell:#1e355b; --muted:#a8b3c7; --text:#eaf2ff;
    --c1:#e74c3c; --c2:#2ecc71; --c3:#3498db; --c4:#f1c40f; --c5:#9b59b6; --c6:#1abc9c; --c7:#e67e22;
  }
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Arial}
  .wrap{width:min(520px,94vw);margin:14px auto;padding:10px}
  .top{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
  .chip{background:#0c1a2e;border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:6px 10px;font-size:13px;color:var(--muted)}
  .chip b{color:var(--text)}
  .game{
    position:relative; background:var(--board); border-radius:12px; overflow:hidden;
    border:1px solid rgba(255,255,255,.08);
  }
  .board{aspect-ratio:10/20; width:100%; position:relative}
  .grid{position:absolute;inset:0;display:grid;grid-template-columns:repeat(10,1fr);grid-auto-rows:1fr}
  .cell{border:1px solid rgba(255,255,255,.05);background:var(--cell)}
  .cI{background:var(--c6)} .cO{background:var(--c4);color:#222}
  .cT{background:var(--c5)} .cS{background:var(--c2)}
  .cZ{background:var(--c1)} .cJ{background:var(--c3)} .cL{background:var(--c7)}

  /* صندوق القادم على اليمين أعلى اللوحة */
  .nextBox{
    position:absolute; top:8px; right:8px; width:110px; background:#0f1d33;
    border:1px solid rgba(255,255,255,.1); border-radius:10px; padding:8px;
  }
  .nextTitle{font-size:12px;color:var(--muted);margin-bottom:6px}
  .nextGrid{display:grid;grid-template-columns:repeat(4,1fr);grid-auto-rows:1fr;gap:2px;aspect-ratio:1/1}
  .nc{background:var(--cell);border:1px solid rgba(255,255,255,.05)}

  /* أزرار التحكم جوه الواجهة تحت اللوحة */
  .controls{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:10px;background:#0f1d33}
  .btn{background:#112746;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:12px 10px;text-align:center;font-size:18px;color:var(--text)}
  .btn:active{transform:translateY(1px)}
  .btn.big{grid-column:1/-1;font-weight:700}

  /* جيم أوفر */
  .gover{position:absolute;inset:0;background:rgba(0,0,0,.55);display:none;place-items:center;z-index:5}
  .gover .box{background:#0f1d33;border:1px solid rgba(255,255,255,.14);border-radius:12px;padding:14px;text-align:center;width:80%}
  .gover h3{margin:6px 0 8px}

  @media (max-width:460px){ .wrap{width:96vw} }
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div class="chip">المستوى: <b id="level">1</b></div>
    <div class="chip">الخطوط: <b id="lines">0</b></div>
    <div class="chip">أفضل نتيجة: <b id="best">0</b></div>
    <button id="reset" class="chip" style="cursor:pointer">إعادة</button>
  </div>

  <div class="game">
    <div class="board">
      <div class="gover" id="gover"><div class="box">
        <h3>انتهت اللعبة</h3>
        <div style="color:#b9c4d6;font-size:13px">وصلت القطع لأعلى الصفوف.</div>
        <button class="btn" id="playAgain" style="margin-top:8px">لعب من جديد</button>
      </div></div>

      <div class="nextBox">
        <div class="nextTitle">القادم</div>
        <div class="nextGrid" id="nextGrid"></div>
      </div>

      <div class="grid" id="grid"></div>
    </div>

    <div class="controls">
      <div class="btn" id="left">←</div>
      <div class="btn" id="down">↓</div>
      <div class="btn" id="right">→</div>
      <div class="btn" id="rotate">⟲ تدوير</div>
      <div class="btn big" id="hard">⟱ هارد دروب</div>
    </div>
  </div>
</div>

<script>
(()=> {
  const COLS=10, ROWS=20;
  const gridEl=document.getElementById('grid');
  const nextEl=document.getElementById('nextGrid');
  const levelEl=document.getElementById('level');
  const linesEl=document.getElementById('lines');
  const bestEl=document.getElementById('best');
  const goverEl=document.getElementById('gover');

  // خلايا اللوحة
  const cells=[];
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      const d=document.createElement('div'); d.className='cell';
      gridEl.appendChild(d); cells.push(d);
    }
  }
  // خلايا القادم 4x4
  const ncs=[]; for(let i=0;i<16;i++){const d=document.createElement('div'); d.className='nc'; nextEl.appendChild(d); ncs.push(d);}

  const SHAPES={I:[[1,1,1,1]],O:[[1,1],[1,1]],T:[[1,1,1],[0,1,0]],S:[[0,1,1],[1,1,0]],Z:[[1,1,0],[0,1,1]],J:[[1,0,0],[1,1,1]],L:[[0,0,1],[1,1,1]]};
  const COLOR={'I':'cI','O':'cO','T':'cT','S':'cS','Z':'cZ','J':'cJ','L':'cL'};

  let field,cur,next,x,y,dropMs,timer,lines=0,level=1,best=+localStorage.getItem('tBest')||0,over=false;

  function empty(){return Array.from({length:ROWS},()=>Array(COLS).fill(0))}
  function rnd(){const ks=Object.keys(SHAPES); const k=ks[Math.floor(Math.random()*ks.length)]; return {k,m:SHAPES[k].map(r=>r.slice())};}
  function rot(m){const R=m.length,C=m[0].length, o=Array.from({length:C},()=>Array(R).fill(0)); for(let r=0;r<R;r++)for(let c=0;c<C;c++)o[c][R-1-r]=m[r][c]; return o;}
  function hud(){levelEl.textContent=level; linesEl.textContent=lines; bestEl.textContent=best;}
  function collide(nx=x,ny=y,m=cur.m){
    for(let r=0;r<m.length;r++)for(let c=0;c<m[0].length;c++){
      if(!m[r][c]) continue; const X=nx+c,Y=ny+r;
      if(X<0||X>=COLS||Y>=ROWS) return true;
      if(Y>=0 && field[Y][X]) return true;
    } return false;
  }
  function merge(){
    for(let r=0;r<cur.m.length;r++)for(let c=0;c<cur.m[0].length;c++)
      if(cur.m[r][c]){const X=x+c,Y=y+r; if(Y>=0) field[Y][X]=cur.k;}
  }
  function clearLines(){
    let n=0;
    for(let r=ROWS-1;r>=0;r--){
      if(field[r].every(v=>v)){ field.splice(r,1); field.unshift(Array(COLS).fill(0)); n++; r++; }
    }
    if(n){
      lines+=n; const nl=Math.floor(lines/10)+1;
      if(nl>level){level=nl; dropMs=Math.max(120,Math.floor(dropMs*0.88)); loop();}
      if(lines>best){best=lines; localStorage.setItem('tBest',best);}
      hud();
    }
  }
  function drawNext(){
    ncs.forEach(c=>c.className='nc');
    const m=next.m, offR=Math.floor((4-m.length)/2), offC=Math.floor((4-m[0].length)/2);
    for(let r=0;r<m.length;r++)for(let c=0;c<m[0].length;c++) if(m[r][c]){
      ncs[(r+offR)*4+(c+offC)].classList.add(COLOR[next.k]);
    }
  }
  function render(){
    cells.forEach(c=>c.className='cell');
    for(let r=0;r<ROWS;r++)for(let c=0;c<COLS;c++){const v=field[r][c]; if(v) cells[r*COLS+c].classList.add(COLOR[v]);}
    for(let r=0;r<cur.m.length;r++)for(let c=0;c<cur.m[0].length;c++) if(cur.m[r][c]){
      const X=x+c,Y=y+r; if(Y>=0&&Y<ROWS&&X>=0&&X<COLS) cells[Y*COLS+X].classList.add(COLOR[cur.k]);
    }
  }
  function spawn(){
    cur=next; next=rnd(); x=3; y=0;
    if(collide(x,y,cur.m)){ over=true; showGO(); clearInterval(timer); }
    drawNext();
  }
  function tick(){
    if(over) return;
    if(!collide(x,y+1)) y++; else { merge(); clearLines(); spawn(); }
    render();
  }
  function loop(){ clearInterval(timer); timer=setInterval(tick,dropMs); }

  function showGO(){ document.getElementById('gover').style.display='grid'; }
  function hideGO(){ document.getElementById('gover').style.display='none'; }

  // تحكم
  const left = ()=>{ if(!collide(x-1,y)){x--; render();} };
  const right= ()=>{ if(!collide(x+1,y)){x++; render();} };
  const down = ()=>{ if(!collide(x,y+1)){y++; render();} };
  const rotate=()=>{ const m=rot(cur.m); if(!collide(x,y,m)) cur.m=m; else if(!collide(x-1,y,m)) {x--;cur.m=m;} else if(!collide(x+1,y,m)){x++;cur.m=m;} render(); };
  const hard = ()=>{ while(!collide(x,y+1)) y++; render(); tick(); };

  document.getElementById('left').onclick=left;
  document.getElementById('right').onclick=right;
  document.getElementById('down').onclick=down;
  document.getElementById('rotate').onclick=rotate;
  document.getElementById('hard').onclick=hard;

  window.addEventListener('keydown',e=>{
    if(over && e.key.toLowerCase()!=='r') return;
    if(e.key==='ArrowLeft') left();
    else if(e.key==='ArrowRight') right();
    else if(e.key==='ArrowDown') down();
    else if(['ArrowUp',' '].includes(e.key)) rotate();
    else if(e.key==='Enter' || e.key==='Shift') hard();
    else if(e.key.toLowerCase()==='r') reset();
  });

  document.getElementById('playAgain').onclick=reset;
  document.getElementById('reset').onclick=reset;

  function reset(){
    field=empty(); cur=rnd(); next=rnd(); x=3; y=0; dropMs=800;
    lines=0; level=1; over=false; hud(); drawNext(); render(); hideGO(); loop();
  }
  reset();
})();
</script>
</body>
</html>

<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Basket — Safe Boot</title>
<style>
  html,body{margin:0;height:100%;background:#0b0f18;color:#eaf0ff;font-family:system-ui,Arial}
  #root{max-width:560px;margin:0 auto;padding:12px}
  #err{background:#2b1111;color:#ffdede;border:1px solid #ff6b6b;padding:10px;border-radius:12px;display:none}
  canvas{width:100%;height:720px;display:block;border-radius:20px;box-shadow:0 20px 60px #000a}
</style>
</head>
<body>
<div id="root">
  <div id="err"></div>
  <canvas id="game" width="560" height="720"></canvas>
</div>

<script>
/* ---- حارس أخطاء عام ---- */
window.addEventListener('error', (e)=>{
  const box=document.getElementById('err');
  box.style.display='block';
  box.textContent='JS Error: '+(e.message||e.error);
});

/* ---- رسومات مدمجة (SVG -> Image) ---- */
const svgCourt=`<svg width="560" height="720" viewBox="0 0 560 720" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="sky" x1="0" y1="0" x2="0" y2="1"><stop offset="0" stop-color="#4da0ff"/><stop offset="1" stop-color="#74e1ff"/></linearGradient>
    <radialGradient id="spot" cx="50%" cy="16%" r="30%"><stop offset="0" stop-color="#fff" stop-opacity=".35"/><stop offset="1" stop-color="#fff" stop-opacity="0"/></radialGradient>
    <linearGradient id="wood" x1="0" x2="1"><stop offset="0" stop-color="#a86c3a"/><stop offset="1" stop-color="#d79a5f"/></linearGradient>
  </defs>
  <rect width="560" height="720" fill="#0b0f18"/><rect x="40" y="80" width="480" height="560" rx="24" fill="url(#sky)"/>
  <ellipse cx="280" cy="160" rx="180" ry="30" fill="url(#spot)"/>
  <g transform="translate(40,80)"><ellipse cx="240" cy="420" rx="220" ry="90" fill="#000" opacity=".22"/>
    <clipPath id="cut"><ellipse cx="240" cy="410" rx="220" ry="90"/></clipPath>
    <g clip-path="url(#cut)"><rect x="20" y="320" width="440" height="180" fill="url(#wood)"/>
      <g opacity=".35">${Array.from({length:25},(_,i)=>`<rect x="${20+i*16}" y="320" width="2" height="180" fill="#000"/>`).join('')}</g>
    </g>
    <ellipse cx="240" cy="400" rx="120" ry="48" fill="none" stroke="#ffffff66" stroke-width="6"/>
  </g></svg>`.trim();

const svgHoop=`<svg width="420" height="300" viewBox="0 0 420 300" xmlns="http://www.w3.org/2000/svg">
  <rect x="95" y="30" width="230" height="26" rx="12" fill="#eaf0ff"/>
  <rect x="120" y="56" width="14" height="110" rx="7" fill="#eaf0ff"/>
  <rect x="286" y="56" width="14" height="110" rx="7" fill="#eaf0ff"/>
  <path d="M140 170 Q210 196 280 170" stroke="#ff6a2e" stroke-width="18" fill="none" stroke-linecap="round"/>
  <g id="net" stroke="#fff" stroke-width="3" opacity=".95">
    <path d="M154 170 L210 250"/><path d="M168 170 L224 250"/><path d="M182 170 L238 250"/>
    <path d="M196 170 L252 246"/><path d="M210 170 L266 238"/><path d="M224 170 L254 228"/><path d="M238 170 L242 220"/>
  </g></svg>`.trim();

const svgBall=`<svg width="160" height="160" viewBox="0 0 160 160" xmlns="http://www.w3.org/2000/svg">
  <defs><radialGradient id="g1" cx="35%" cy="35%" r="30%"><stop offset="0" stop-color="#ffbe8a"/><stop offset="1" stop-color="#ff9247"/></radialGradient>
  <radialGradient id="g2" cx="68%" cy="72%" r="60%"><stop offset="0" stop-color="#ff6e22"/><stop offset="1" stop-color="#c94a10"/></radialGradient></defs>
  <circle cx="80" cy="80" r="78" fill="url(#g2)"/><circle cx="56" cy="56" r="32" fill="url(#g1)"/>
  <g stroke="rgba(0,0,0,.45)" stroke-width="6" fill="none"><path d="M20,78 a60,60 0 0 0 120,0"/><path d="M20,78 a60,60 0 0 1 120,0"/></g>
</svg>`.trim();

/* ---- رسم Canvas بسيط (من غير Phaser) لضمان الاشتغال) ---- */
const cv = document.getElementById('game');
const ctx = cv.getContext('2d');

function loadSVG(str){
  return new Promise((res,rej)=>{
    const img = new Image();
    img.onload = ()=>res(img);
    img.onerror = e=>rej(e);
    img.src = 'data:image/svg+xml;utf8,'+encodeURIComponent(str);
  });
}

(async function boot(){
  try{
    const [court,hoop,ballImg] = await Promise.all([loadSVG(svgCourt), loadSVG(svgHoop), loadSVG(svgBall)]);
    // رسم خلفية
    ctx.drawImage(court,0,0,cv.width,cv.height);
    // سلة
    const hoopX=cv.width/2, hoopY=230;
    ctx.drawImage(hoop, hoopX-210, hoopY-150, 420, 300);
    // كرة (ثابتة كاختبار)
    ctx.drawImage(ballImg, cv.width/2-40, 560, 80,80);

    // مسج نجاح صغير
    ctx.fillStyle='#a7ffcf'; ctx.font='bold 14px system-ui';
    ctx.fillText('OK: Canvas drew court/hoop/ball — الشغل شغّال', 14, 24);
  }catch(err){
    const box=document.getElementById('err');
    box.style.display='block';
    box.textContent='Asset load failed: '+err;
  }
})();
</script>
</body>
</html>

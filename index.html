<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Number Match — Simple</title>
<style>
  :root{
    --bg:#0b0f18; --panel:#11182a; --panel2:#0e1423; --ring:#ffffff24;
    --text:#ecf1ff; --muted:#9db0d1; --gold1:#ffd46a; --gold2:#ffb724;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:radial-gradient(1200px 620px at 50% -10%,#1b2540 0,#0b0f18 60%);color:var(--text);font-family:system-ui,Segoe UI,Arial}
  .wrap{max-width:700px;margin:0 auto;padding:14px}
  .hud{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:10px}
  .badge{background:linear-gradient(180deg,var(--panel),var(--panel2));border-radius:16px;padding:10px 12px;text-align:center;box-shadow:0 12px 26px #000a,inset 0 1px 0 var(--ring)}
  .k{font-size:12px;color:var(--muted)} .v{font-weight:800;font-size:20px}
  .bar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
  button{border:0;border-radius:12px;padding:10px 12px;font-weight:700;color:#0b0f18;background:linear-gradient(180deg,var(--gold1),var(--gold2));box-shadow:0 10px 22px #0007,inset 0 1px 0 #fff7;cursor:pointer}
  button.secondary{background:#1a2337;color:#cfe2ff;border:1px solid var(--ring)}
  .board{background:linear-gradient(180deg,var(--panel),var(--panel2));border-radius:18px;padding:10px;box-shadow:0 22px 60px #000a,inset 0 1px 0 var(--ring)}
  .grid{display:grid;gap:8px}
  .cell{width:56px;height:56px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:22px;user-select:none;transition:.12s transform, .12s box-shadow, .2s background}
  .cell.empty{background:#0d1324;border:1px dashed #2b3756;color:#2b3756}
  .cell.num{box-shadow:0 6px 14px #0006}
  .sel{outline:3px solid #ffee9a}
  .flash{animation:flash .55s ease}
  @keyframes flash{0%{transform:scale(1)}50%{transform:scale(1.08)}100%{transform:scale(1)}}
  .footer{margin-top:8px;color:var(--muted);font-size:12px;text-align:center}
  .rules{margin-top:10px;background:#101828;border:1px solid var(--ring);border-radius:12px;padding:10px;color:#cfe2ff}
  @media (max-width:560px){ .cell{width:44px;height:44px;font-size:19px} }
</style>
</head>
<body>
<div class="wrap">
  <div class="hud">
    <div class="badge"><div class="k">السكور</div><div class="v" id="score">0</div></div>
    <div class="badge"><div class="k">هاي سكور</div><div class="v" id="best">0</div></div>
    <div class="badge"><div class="k">صفوف</div><div class="v" id="rows">9</div></div>
    <div class="badge"><div class="k">عُمر الجولة</div><div class="v" id="moves">0</div></div>
  </div>

  <div class="bar">
    <button id="new">جولة جديدة</button>
    <button class="secondary" id="hint">Hint</button>
    <button class="secondary" id="shuffle">Shuffle</button>
    <button class="secondary" id="add">Add Row</button>
    <button class="secondary" id="undo">Undo</button>
  </div>

  <div class="board">
    <div id="grid" class="grid"></div>
  </div>

  <div class="rules">
    <b>القواعد المبسّطة:</b>
    <ul>
      <li>امسح زوجين مجموعهم <b>10</b> أو رقمين <b>متساويين</b>.</li>
      <li>لازم يكونوا <b>ملاصقين</b> (أفقي/رأسي/قطري) أو على <b>نفس الصف/العمود</b> وبينهم <b>فراغات فقط</b> (من غير أرقام).</li>
      <li>تقدر تستخدم Hint / Shuffle / Add Row / Undo.</li>
      <li>الصفوف الفارغة بتتشال تلقائياً.</li>
    </ul>
  </div>

  <div class="footer">Number Match – نسخة خفيفة تصلح لـ GitHub Pages وTelegram WebApp</div>
</div>

<script>
/* ==== Config ==== */
const COLS = 9;
const START_ROWS = 9;
const COLORS = {
  1:'#67e8f9', 2:'#60a5fa', 3:'#a78bfa', 4:'#34d399',
  5:'#fbbf24', 6:'#fb7185', 7:'#f472b6', 8:'#22d3ee', 9:'#c084fc'
};
const SCORE_PAIR = 10;

/* ==== State ==== */
let grid = []; // 2D rows x cols; values: 1..9 or null
let sel = null;
let score = 0, best = Number(localStorage.getItem('nm_best')||0);
let moves = 0;
let history = []; // for undo: push snapshots

/* ==== DOM ==== */
const gridEl = document.getElementById('grid');
const scoreEl = document.getElementById('score');
const bestEl = document.getElementById('best');
const rowsEl = document.getElementById('rows');
const movesEl = document.getElementById('moves');
bestEl.textContent = best;

document.getElementById('new').onclick = newGame;
document.getElementById('hint').onclick = hint;
document.getElementById('shuffle').onclick = shuffleBoard;
document.getElementById('add').onclick = addRow;
document.getElementById('undo').onclick = undo;

/* ==== Helpers ==== */
const inside = (r,c)=> r>=0 && c>=0 && r<grid.length && c<COLS;
function snapshot(){
  // shallow-copy rows
  history.push({
    grid: grid.map(row=>row.slice()),
    score, moves, sel: sel? {...sel}:null
  });
  if(history.length>40) history.shift();
}
function restore(state){
  grid = state.grid.map(r=>r.slice());
  score = state.score; moves = state.moves; sel = state.sel;
  render();
}
function rand1to9(){ return 1 + Math.floor(Math.random()*9); }
function pathClearSameRow(r,c1,c2){
  const [a,b] = c1<c2 ? [c1,c2] : [c2,c1];
  for(let x=a+1;x<b;x++){ if(grid[r][x]!==null) return false; }
  return true;
}
function pathClearSameCol(c,r1,r2){
  const [a,b] = r1<r2 ? [r1,r2] : [r2,r1];
  for(let y=a+1;y<b;y++){ if(grid[y][c]!==null) return false; }
  return true;
}
function neighbors(r1,c1,r2,c2){
  return Math.max(Math.abs(r1-r2),Math.abs(c1-c2))===1;
}

function validPair(a,b){
  if(!a||!b) return false;
  if(a.r===b.r && a.c===b.c) return false;
  const v1 = grid[a.r][a.c], v2 = grid[b.r][b.c];
  if(v1===null || v2===null) return false;
  if(!(v1===v2 || v1+v2===10)) return false;

  // adjacency OR straight line path with only empty cells between
  if(neighbors(a.r,a.c,b.r,b.c)) return true;
  if(a.r===b.r && pathClearSameRow(a.r,a.c,b.c)) return true;
  if(a.c===b.c && pathClearSameCol(a.c,a.r,b.r)) return true;

  return false;
}

/* ==== Game logic ==== */
function newGame(){
  score=0; moves=0; history.length=0; sel=null;
  grid = [];
  for(let r=0;r<START_ROWS;r++){
    const row=[];
    for(let c=0;c<COLS;c++) row.push(rand1to9());
    grid.push(row);
  }
  render(true);
}
function addRow(){
  snapshot();
  const row=[];
  for(let c=0;c<COLS;c++) row.push(rand1to9());
  grid.push(row);
  render();
}
function clearEmptyRows(){
  const before = grid.length;
  grid = grid.filter(row=> row.some(v=>v!==null));
  if(grid.length===0){ grid.push(Array.from({length:COLS},()=>null)); }
  if(before!==grid.length) render();
}
function removePair(a,b){
  snapshot();
  grid[a.r][a.c]=null; grid[b.r][b.c]=null;
  score += SCORE_PAIR; moves++;
  if(score>best){ best=score; localStorage.setItem('nm_best',best); }
  sel=null;
  clearEmptyRows();
  render();
}
function hint(){
  const p=findAnyPair();
  if(!p){ pulseBar('ملهاش أزواج… جرّب Shuffle أو Add Row'); return; }
  pulseCells([p.a,p.b]);
}
function shuffleBoard(){
  snapshot();
  const vals=[];
  grid.forEach(row=>row.forEach(v=>{ if(v!==null) vals.push(v); }));
  // Fisher–Yates
  for(let i=vals.length-1;i>0;i--){ const j= Math.floor(Math.random()*(i+1)); [vals[i],vals[j]]=[vals[j],vals[i]]; }
  grid.forEach(row=>row.forEach((v,idx)=>{ if(v!==null) row[idx]=vals.pop(); }));
  moves++;
  render();
}
function undo(){
  const last=history.pop();
  if(last) restore(last);
}

function findAnyPair(){
  const coords=[];
  for(let r=0;r<grid.length;r++)
    for(let c=0;c<COLS;c++)
      if(grid[r][c]!==null) coords.push({r,c});
  for(let i=0;i<coords.length;i++){
    for(let j=i+1;j<coords.length;j++){
      const a=coords[i], b=coords[j];
      if(validPair(a,b)) return {a,b};
    }
  }
  return null;
}

/* ==== Rendering ==== */
function render(resetGridSize){
  scoreEl.textContent=score; bestEl.textContent=best; rowsEl.textContent=grid.length; movesEl.textContent=moves;
  // grid CSS
  gridEl.style.gridTemplateColumns=`repeat(${COLS}, 1fr)`;
  if(resetGridSize){ gridEl.innerHTML=''; }

  // rebuild DOM each render (بسيطة وسهلة)
  gridEl.innerHTML='';
  for(let r=0;r<grid.length;r++){
    for(let c=0;c<COLS;c++){
      const v=grid[r][c];
      const div=document.createElement('div');
      div.className='cell '+(v===null?'empty':'num');
      div.dataset.r=r; div.dataset.c=c;
      if(v!==null){
        div.textContent=v;
        div.style.background=COLORS[v]||'#7dd3fc';
        div.style.color='#0b0f18';
      }else{
        div.textContent='';
        div.style.border='1px dashed #2b3756';
        div.style.color='#2b3756';
      }
      if(sel && sel.r===r && sel.c===c) div.classList.add('sel');
      div.onclick=()=>onCellClick(r,c);
      gridEl.appendChild(div);
    }
  }
}
function onCellClick(r,c){
  if(grid[r][c]===null) return;
  const cur={r,c};
  if(!sel){ sel=cur; render(); return; }

  if(sel.r===r && sel.c===c){ sel=null; render(); return; }

  if(validPair(sel,cur)){
    removePair(sel,cur);
  }else{
    // بدّل الاختيار
    sel=cur; render();
  }
}
function pulseCells(list){
  list.forEach(({r,c})=>{
    const idx=r*COLS+c;
    const cell = gridEl.children[idx];
    cell.classList.add('flash');
    setTimeout(()=>cell.classList.remove('flash'),600);
  });
}
function pulseBar(msg){
  const el=document.querySelector('.footer');
  const old=el.textContent;
  el.textContent=msg;
  el.style.color='#ffd46a';
  setTimeout(()=>{el.textContent=old; el.style.color='';},1600);
}

/* ==== Start ==== */
newGame();
</script>
</body>
</html>
